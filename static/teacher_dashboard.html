<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Teacher">
    <meta name="description" content="Teacher Dashboard - Manage attendance and view class statistics">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="/manifest.json">
    <title>Teacher Dashboard - Attendance System</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="dashboard">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="navbar-brand">üë®‚Äçüè´ Teacher Dashboard</div>
            <div class="navbar-user">
                <span id="teacherName">Loading...</span>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </nav>

        <!-- Dashboard Container -->
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1>Welcome, <span id="welcomeName">Teacher</span></h1>
                <p>Manage attendance and view class statistics</p>
            </div>

            <!-- Statistics Cards -->
            <div class="dashboard-grid">
                <div class="stat-card primary">
                    <h3>Total Sessions</h3>
                    <div class="stat-value" id="totalSessions">0</div>
                </div>
                <div class="stat-card success">
                    <h3>Active Sessions</h3>
                    <div class="stat-value" id="activeSessions">0</div>
                </div>
                <div class="stat-card warning">
                    <h3>Branch</h3>
                    <div class="stat-value" id="teacherBranch" style="font-size: 1.25rem;">-</div>
                </div>
                <div class="stat-card">
                    <h3>Designation</h3>
                    <div class="stat-value" id="teacherDesignation" style="font-size: 1.25rem;">-</div>
                </div>
            </div>

            <!-- Profile Section -->
            <div class="section-card">
                <h2>üìã Profile Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>Teacher ID</label>
                        <div class="value" id="profileTeacherId">-</div>
                    </div>
                    <div class="info-item">
                        <label>Email</label>
                        <div class="value" id="profileEmail">-</div>
                    </div>
                    <div class="info-item">
                        <label>Qualification</label>
                        <div class="value" id="profileQualification">-</div>
                    </div>
                    <div class="info-item">
                        <label>Specialization</label>
                        <div class="value" id="profileSpecialization">-</div>
                    </div>
                    <div class="info-item">
                        <label>Experience</label>
                        <div class="value" id="profileExperience">-</div>
                    </div>
                    <div class="info-item">
                        <label>Phone</label>
                        <div class="value" id="profilePhone">-</div>
                    </div>
                </div>
            </div>

            <!-- Create New Session -->
            <div class="section-card">
                <h2>‚ûï Create New Attendance Session</h2>
                <div id="createSessionAlert"></div>
                <form id="createSessionForm" onsubmit="event.preventDefault(); createSession();">
                    <div class="info-grid">
                        <div class="form-group">
                            <label>1. Branch *</label>
                            <select id="sessionBranch" required onchange="updateSemesterAndSubject()">
                                <option value="">Select Branch First</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Civil">Civil</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>2. Semester *</label>
                            <select id="sessionSemester" required onchange="updateSubjects()" disabled>
                                <option value="">Select Semester</option>
                                <option value="1">Semester 1</option>
                                <option value="2">Semester 2</option>
                                <option value="3">Semester 3</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                                <option value="7">Semester 7</option>
                                <option value="8">Semester 8</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>3. Subject *</label>
                            <select id="sessionSubject" required disabled>
                                <option value="">Select Subject</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>4. Division *</label>
                            <select id="sessionDivision" required>
                                <option value="">Select Division</option>
                                <option value="Division A">Division A</option>
                                <option value="Division B">Division B</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>5. Total Students *</label>
                            <input type="number" id="sessionTotalStudents" placeholder="e.g., 10" min="1" max="500" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Create Session</button>
                </form>
            </div>

            <!-- QR Code Display Section -->
            <div class="section-card" id="qrSection" style="display: none;">
                <h2>üì± QR Code for Attendance</h2>
                <div class="qr-container">
                    <div id="qrAlert"></div>
                    <div class="qr-code-display">
                        <h3 id="qrSessionTitle">Session Active</h3>
                        <div id="qrCodeContainer">
                            <!-- QR code will be displayed here -->
                        </div>
                        <div class="qr-timer" id="qrTimer">Generating...</div>
                        <div class="qr-info">
                            <p><strong>Subject:</strong> <span id="qrSubject">-</span></p>
                            <p><strong>Division:</strong> <span id="qrDivision">-</span></p>
                            <p><strong>Present:</strong> <span id="qrPresentCount">0</span> / <span id="qrTotalStudents">0</span></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="attendanceProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="endSession()" style="margin-top: 1rem;">End Session</button>
                    </div>
                </div>
            </div>

            <!-- Subject Statistics -->
            <div class="section-card">
                <h2>üìä Subject-wise Statistics</h2>
                <div id="subjectStatsContainer">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- WiFi Network Management -->
            <div class="section-card">
                <h2>üì° WiFi Network Management</h2>
                <p style="margin-bottom: 1rem; color: #6b7280;">Manage authorized WiFi networks for attendance authentication</p>
                <div id="wifiAlert"></div>
                
                <!-- Add WiFi Network Form -->
                <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Add New WiFi Network</h3>
                    <form id="addWiFiForm" onsubmit="event.preventDefault(); addWiFiNetwork();">
                        <div class="info-grid">
                            <div class="form-group">
                                <label>SSID (Network Name) *</label>
                                <input type="text" id="wifiSSID" placeholder="e.g., College_CS_Lab1" required>
                            </div>
                            <div class="form-group">
                                <label>BSSID (MAC Address)</label>
                                <input type="text" id="wifiBSSID" placeholder="e.g., AA:BB:CC:DD:EE:FF">
                            </div>
                            <div class="form-group">
                                <label>Location *</label>
                                <input type="text" id="wifiLocation" placeholder="e.g., Computer Lab 1, Building A" required>
                            </div>
                            <div class="form-group">
                                <label>Branch *</label>
                                <select id="wifiBranch" required>
                                    <option value="">Select Branch</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Information Technology">Information Technology</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Civil">Civil</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Room Number</label>
                                <input type="text" id="wifiRoomNumber" placeholder="e.g., 101">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Add WiFi Network</button>
                    </form>
                </div>
                
                <!-- WiFi Networks List -->
                <div id="wifiNetworksContainer">
                    <h3 style="margin-bottom: 1rem;">Active WiFi Networks</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>SSID</th>
                                    <th>Location</th>
                                    <th>Branch</th>
                                    <th>Room</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="wifiNetworksBody">
                                <tr>
                                    <td colspan="6" style="text-align: center;">
                                        <div class="spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Recent Sessions -->
            <div class="section-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="margin: 0;">üìÖ Recent Sessions</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-primary" onclick="refreshRecentSessions()" id="refreshSessionsBtn" style="padding: 0.4rem 0.8rem; font-size: 0.75rem;">
                        <span id="refreshIcon">üîÑ</span> Refresh
                    </button>
                        <button class="btn btn-secondary" onclick="clearRecentSessions()" id="clearSessionsBtn" style="padding: 0.4rem 0.8rem; font-size: 0.75rem;">
                            Clear
                        </button>
                    </div>
                </div>
                <div id="recentSessionsContainer">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Session ID</th>
                                    <th>Subject</th>
                                    <th>Branch</th>
                                    <th>Division</th>
                                    <th>Date</th>
                                    <th>Present</th>
                                    <th>Status</th>
                                    <th>Manage Session</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentSessionsBody">
                                <tr>
                                    <td colspan="9" style="text-align: center;">
                                        <div class="spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Analysis Modal -->
    <div id="sessionAnalysisModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button onclick="handleCloseModal(event)" class="modal-close-btn" aria-label="Close">&times;</button>
            
            <h2 style="margin-top: 0; margin-bottom: 1.5rem;">üìä Session Analysis</h2>
            
            <div id="sessionAnalysisContent">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <script src="/js/mobile-utils.js?v=2.0"></script>
    <script src="/js/api.js?v=2.0"></script>
    <script src="/js/teacher_dashboard.js?v=2.0"></script>
</body>
</html>

